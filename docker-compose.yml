# ============================================================
# WARNING: 開発環境専用 / FOR DEVELOPMENT ONLY
# ============================================================
# このdocker-compose.ymlは開発・テスト用です。
# 本番環境では使用しないでください。
#
# This docker-compose.yml is for development and testing only.
# DO NOT use in production environments.
#
# 資格情報を変更する場合は.envファイルを作成してください:
# To customize credentials, create a .env file:
#   POSTGRES_USER=your_user
#   POSTGRES_PASSWORD=your_secure_password
#   POSTGRES_DB=your_database
# ============================================================

version: '3.8'

services:
  postgres:
    image: postgres:16-alpine
    container_name: hobbs-postgres
    environment:
      POSTGRES_USER: ${POSTGRES_USER:-hobbs}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD:-hobbs_dev_password}
      POSTGRES_DB: ${POSTGRES_DB:-hobbs}
    ports:
      # Bind to localhost only to prevent external access
      - "127.0.0.1:5433:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-hobbs} -d ${POSTGRES_DB:-hobbs}"]
      interval: 5s
      timeout: 5s
      retries: 5

  postgres-test:
    image: postgres:16-alpine
    container_name: hobbs-postgres-test
    environment:
      POSTGRES_USER: ${POSTGRES_TEST_USER:-hobbs}
      POSTGRES_PASSWORD: ${POSTGRES_TEST_PASSWORD:-hobbs_test_password}
      POSTGRES_DB: ${POSTGRES_TEST_DB:-hobbs_test}
    ports:
      # Bind to localhost only to prevent external access
      - "127.0.0.1:5434:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_TEST_USER:-hobbs} -d ${POSTGRES_TEST_DB:-hobbs_test}"]
      interval: 5s
      timeout: 5s
      retries: 5

volumes:
  postgres_data:
